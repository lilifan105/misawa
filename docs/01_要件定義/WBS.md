# WBS - 文書管理システム開発

## プロジェクト概要
- **目的**: 通達・連絡・ライブラリ文書の管理・検索システム
- **技術スタック**: React (SPA) + AWS Amplify + Lambda + DynamoDB + OpenSearch + Bedrock
- **特徴**: サーバーレス、RAG検索、外部API連携 (GCP)

---

## 1. プロジェクト準備・要件定義 (10日)

### 1.1 要件定義・詳細化 (3日)
- [ ] 要件定義書レビューと詳細化
- [ ] ユースケース詳細化
- [ ] 画面遷移図作成
- [ ] データモデル詳細設計

### 1.2 システム設計 (4日)
- [ ] システム構成図作成
- [ ] AWSサービス選定と構成設計
- [ ] セキュリティ設計
- [ ] RAG設計 (OpenSearch + Bedrock)
- [ ] 外部API仕様設計 (GCP連携)
- [ ] コスト見積もり

### 1.3 開発環境構築 (3日)
- [ ] AWSアカウント設定
- [ ] Amplify CLI インストール・設定
- [ ] ローカル開発環境構築 (Node.js, React, AWS CLI)
- [ ] Gitリポジトリ作成
- [ ] プロジェクト構造作成
- [ ] 開発環境 (dev) 初期構築

---

## 2. 基盤構築フェーズ (15日)

### 2.1 認証基盤構築 (4日)
- [ ] Cognito User Pool作成 (Amplify)
- [ ] ユーザーグループ設定 (閲覧者、投稿者、承認者、管理者)
- [ ] 認証フロー実装
- [ ] テストユーザー作成
- [ ] 認証テスト

### 2.2 API基盤構築 (4日)
- [ ] API Gateway作成 (Amplify)
- [ ] Lambda関数基礎構築
- [ ] Cognito Authorizer設定
- [ ] 外部API用エンドポイント作成 (APIキー認証)
- [ ] CORS設定
- [ ] API動作テスト

### 2.3 データベース構築 (4日)
- [ ] DynamoDB テーブル設計
  - [ ] 文書マスタテーブル
  - [ ] 添付ファイルテーブル
  - [ ] ユーザーマスタテーブル
  - [ ] 承認履歴テーブル
  - [ ] 閲覧履歴テーブル
  - [ ] 文書版管理テーブル
- [ ] GSI (Global Secondary Index) 設定
- [ ] テストデータ投入
- [ ] DynamoDB動作テスト

### 2.4 ストレージ構築 (3日)
- [ ] S3バケット作成 (PDF保存用)
- [ ] バケットポリシー設定
- [ ] バージョニング有効化
- [ ] ライフサイクルポリシー設定
- [ ] 暗号化設定 (SSE-S3)
- [ ] S3動作テスト

---

## 3. フロントエンド開発フェーズ (20日)

### 3.1 プロジェクト初期化・共通部品 (4日)
- [ ] React プロジェクト作成 (Amplify)
- [ ] ルーティング設定 (React Router)
- [ ] UIライブラリ導入 (Material-UI / Ant Design)
- [ ] 共通レイアウト作成 (ヘッダー、サイドバー、フッター)
- [ ] 共通コンポーネント作成 (ボタン、フォーム、テーブル)
- [ ] 状態管理設定 (Context / Zustand)

### 3.2 認証画面 (3日)
- [ ] ログイン画面実装
- [ ] サインアップ画面実装
- [ ] パスワードリセット画面実装
- [ ] 認証状態管理実装
- [ ] ログアウト機能実装
- [ ] 認証ガード実装

### 3.3 文書一覧画面 (4日)
- [ ] カテゴリツリー表示
- [ ] 文書一覧テーブル実装
- [ ] ページネーション実装
- [ ] 検索条件入力エリア実装
- [ ] 絞り込み機能実装
- [ ] ソート機能実装
- [ ] 既読/未読表示

### 3.4 文書詳細画面 (3日)
- [ ] 文書基本情報表示
- [ ] 発番情報表示
- [ ] 公開情報表示
- [ ] PDFプレビュー実装
- [ ] PDFダウンロード機能
- [ ] 版履歴表示
- [ ] 既読登録処理

### 3.5 文書登録・編集画面 (4日)
- [ ] 文書登録フォーム実装
- [ ] 発番部署選択
- [ ] 文書番号入力 (自動採番対応)
- [ ] PDFアップロード機能 (ドラッグ&ドロップ)
- [ ] 複数ファイル対応
- [ ] バリデーション実装
- [ ] 下書き保存機能
- [ ] 編集画面実装
- [ ] 改訂内容入力

### 3.6 承認画面 (2日)
- [ ] 承認待ち文書一覧
- [ ] 文書詳細表示
- [ ] 承認/差し戻しボタン
- [ ] コメント入力
- [ ] 承認処理実装

---

## 4. バックエンド開発フェーズ (25日)

### 4.1 文書管理API (8日)
- [ ] 文書一覧取得API (Lambda)
  - [ ] DynamoDB クエリ実装
  - [ ] 権限フィルタ実装
  - [ ] ページネーション実装
- [ ] 文書詳細取得API (Lambda)
  - [ ] 権限チェック実装
  - [ ] 閲覧履歴登録
- [ ] 文書登録API (Lambda)
  - [ ] バリデーション実装
  - [ ] DynamoDB 保存処理
  - [ ] S3署名付きURL生成
  - [ ] 文書番号採番ロジック
- [ ] 文書更新API (Lambda)
  - [ ] 版管理処理
  - [ ] 旧版ファイル保存
- [ ] 文書削除API (Lambda)
  - [ ] 論理削除実装
- [ ] 単体テスト作成

### 4.2 承認ワークフローAPI (4日)
- [ ] 承認申請API (Lambda)
  - [ ] ステータス更新
  - [ ] 承認者通知 (SES)
- [ ] 承認処理API (Lambda)
  - [ ] 承認履歴登録
  - [ ] ステータス更新
  - [ ] 申請者通知
- [ ] 差し戻し処理API (Lambda)
- [ ] 承認履歴取得API (Lambda)
- [ ] 単体テスト作成

### 4.3 検索・RAG機能 (8日)
- [ ] OpenSearch Service構築
  - [ ] ドメイン作成 (VPC内)
  - [ ] インデックス設計
  - [ ] セキュリティグループ設定
- [ ] PDF処理Lambda実装
  - [ ] S3イベントトリガー設定
  - [ ] PDFテキスト抽出 (pdf-parse)
  - [ ] テキスト前処理
- [ ] Bedrock連携実装
  - [ ] テキスト埋め込み生成 (Titan Embeddings)
  - [ ] OpenSearchインデックス登録
- [ ] 検索API実装 (Lambda)
  - [ ] クエリ埋め込み生成
  - [ ] ベクトル検索実装
  - [ ] 権限フィルタ実装
  - [ ] ハイブリッド検索 (キーワード + ベクトル)
- [ ] RAG応答生成API (Lambda)
  - [ ] コンテキスト生成
  - [ ] Claude連携
  - [ ] 応答生成
- [ ] 単体テスト作成

### 4.4 外部API (GCP連携) (3日)
- [ ] 外部API用Lambda実装
  - [ ] APIキー検証
  - [ ] 権限マッピング (GCPユーザー → 文書権限)
  - [ ] 文書一覧取得 (権限フィルタ)
  - [ ] JSON応答生成
- [ ] API Gateway設定
  - [ ] APIキー作成
  - [ ] 使用量プラン設定
  - [ ] レート制限設定
- [ ] 外部API仕様書作成
- [ ] 単体テスト作成

### 4.5 通知機能 (2日)
- [ ] SES設定
  - [ ] ドメイン検証
  - [ ] メールテンプレート作成
- [ ] 通知Lambda実装
  - [ ] 承認依頼メール
  - [ ] 承認結果メール
  - [ ] 公開通知メール
- [ ] 単体テスト作成

---

## 5. 統合・テストフェーズ (15日)

### 5.1 フロントエンド・バックエンド統合 (5日)
- [ ] API連携実装
- [ ] エラーハンドリング実装
- [ ] ローディング表示実装
- [ ] 統合テスト
- [ ] バグ修正

### 5.2 RAG機能統合テスト (3日)
- [ ] PDF登録→インデックス登録フロー確認
- [ ] 検索精度テスト
- [ ] RAG応答品質テスト
- [ ] 権限フィルタ動作確認
- [ ] パフォーマンステスト
- [ ] バグ修正

### 5.3 外部API統合テスト (2日)
- [ ] GCP連携テスト環境構築
- [ ] APIキー認証テスト
- [ ] 権限フィルタテスト
- [ ] レート制限テスト
- [ ] バグ修正

### 5.4 システムテスト (3日)
- [ ] 全機能統合テスト
- [ ] シナリオテスト
  - [ ] 文書登録→承認→公開フロー
  - [ ] 文書検索→閲覧フロー
  - [ ] 文書編集→版管理フロー
- [ ] 権限テスト (各ロール)
- [ ] セキュリティテスト
- [ ] バグ修正

### 5.5 パフォーマンステスト (2日)
- [ ] 負荷テスト (Lambda, DynamoDB, OpenSearch)
- [ ] レスポンスタイム測定
- [ ] 同時アクセステスト
- [ ] ボトルネック特定と改善

---

## 6. 本番環境構築・リリース (10日)

### 6.1 本番環境構築 (5日)
- [ ] 本番AWSアカウント設定
- [ ] Amplify本番環境作成
- [ ] Cognito本番User Pool作成
- [ ] DynamoDB本番テーブル作成
- [ ] S3本番バケット作成
- [ ] OpenSearch本番ドメイン作成
- [ ] Lambda本番関数デプロイ
- [ ] API Gateway本番設定
- [ ] CloudFront設定
- [ ] カスタムドメイン設定
- [ ] SSL証明書設定

### 6.2 監視・アラート設定 (2日)
- [ ] CloudWatch Dashboards作成
- [ ] CloudWatch Alarms設定
  - [ ] Lambda エラー率
  - [ ] API Gateway レイテンシ
  - [ ] DynamoDB スロットリング
  - [ ] OpenSearch クラスタヘルス
- [ ] SNS通知設定 (Slack/Email)
- [ ] X-Ray有効化
- [ ] コスト監視設定 (AWS Budgets)

### 6.3 本番データ移行 (1日)
- [ ] マスタデータ投入
- [ ] ユーザーデータ移行
- [ ] 既存文書データ移行 (必要時)

### 6.4 本番リリース (2日)
- [ ] 本番環境動作確認
- [ ] リリース手順書作成
- [ ] リリース実施
- [ ] リリース後監視
- [ ] 問題対応

---

## 7. ドキュメント・運用準備 (5日)

### 7.1 ドキュメント作成 (3日)
- [ ] システム設計書最終版
- [ ] API仕様書最終版
- [ ] 運用マニュアル作成
  - [ ] ユーザー管理手順
  - [ ] 文書管理手順
  - [ ] バックアップ・リストア手順
- [ ] 保守マニュアル作成
  - [ ] トラブルシューティング
  - [ ] ログ確認方法
  - [ ] デプロイ手順
- [ ] ユーザーマニュアル作成
  - [ ] 文書登録方法
  - [ ] 文書検索方法
  - [ ] 承認フロー

### 7.2 運用準備 (2日)
- [ ] バックアップ設定確認
- [ ] 障害対応フロー策定
- [ ] エスカレーションフロー策定
- [ ] 運用チーム向けトレーニング

---

## 8. 追加機能開発 (オプション) (15日)

### 8.1 高度な検索機能 (5日)
- [ ] ファセット検索実装
- [ ] 検索履歴機能
- [ ] お気に入り機能
- [ ] タグ機能
- [ ] 関連文書推薦機能

### 8.2 分析・レポート機能 (5日)
- [ ] 文書閲覧統計
- [ ] 部署別利用状況
- [ ] 検索キーワード分析
- [ ] ダッシュボード画面実装
- [ ] グラフ表示 (Chart.js)

### 8.3 モバイル対応 (5日)
- [ ] レスポンシブデザイン改善
- [ ] モバイル専用UI実装
- [ ] プッシュ通知実装 (PWA)
- [ ] オフライン対応

---

## 総工数見積もり

| フェーズ | 工数（日） | 備考 |
|---------|-----------|------|
| プロジェクト準備・要件定義 | 10 | 要件詳細化、設計 |
| 基盤構築 | 15 | 認証、API、DB、ストレージ |
| フロントエンド開発 | 20 | React SPA |
| バックエンド開発 | 25 | Lambda、RAG、外部API |
| 統合・テスト | 15 | 統合テスト、パフォーマンステスト |
| 本番環境構築・リリース | 10 | 本番構築、リリース |
| ドキュメント・運用準備 | 5 | マニュアル作成 |
| **合計 (必須)** | **100日** | |
| 追加機能開発 (オプション) | 15 | 高度な検索、分析、モバイル |
| **総合計** | **115日** | |

※ 1日あたり6-8時間の実作業を想定  
※ バッファとして各フェーズに10-20%の余裕を見込むことを推奨

---

## マイルストーン

| マイルストーン | 完了日 | 成果物 |
|--------------|--------|--------|
| **M1**: 要件定義完了 | 10日目 | 要件定義書、システム構成図 |
| **M2**: 基盤構築完了 | 25日目 | 認証基盤、API基盤、DB、S3 |
| **M3**: フロントエンド開発完了 | 45日目 | React SPA (全画面) |
| **M4**: バックエンド開発完了 | 70日目 | Lambda関数、RAG機能、外部API |
| **M5**: 統合テスト完了 | 85日目 | テスト完了、バグ修正完了 |
| **M6**: 本番リリース | 95日目 | 本番環境稼働 |
| **M7**: プロジェクト完了 | 100日目 | ドキュメント完成、運用開始 |

---

## リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| AWS利用料金の想定超過 | 高 | コスト監視、予算アラート、リソース最適化 |
| OpenSearch構築の複雑性 | 中 | 早期PoC実施、AWS Supportプラン検討 |
| RAG精度の不足 | 中 | プロンプトエンジニアリング、モデル選定 |
| GCP連携の遅延 | 中 | 早期に連携仕様確定、モックAPI作成 |
| Bedrock利用制限 | 低 | サービスクォータ引き上げ申請 |
| 技術的な問題による遅延 | 中 | 技術検証フェーズ設定、代替案準備 |
| 一人開発による知識の属人化 | 高 | ドキュメント整備の徹底、コードレビュー |

---

## 前提条件・制約事項

### 前提条件
- AWSアカウントが利用可能
- Amplify CLIの使用経験がある
- React、Node.js、Pythonの開発経験がある
- OpenSearch、Bedrockの基礎知識がある
- GCP連携先システムのAPI仕様が提供される

### 制約事項
- 開発体制: 1名
- 予算: AWS利用料金を月額XX円以内に抑える
- スケジュール: 100日以内にリリース
- Bedrockリージョン: us-east-1 (バージニア北部) 等の対応リージョン

---

## 成果物一覧

### 設計書
- [ ] 要件定義書
- [ ] システム構成図
- [ ] データモデル設計書
- [ ] API仕様書
- [ ] 画面遷移図
- [ ] セキュリティ設計書

### ソースコード
- [ ] フロントエンド (React)
- [ ] バックエンド (Lambda関数)
- [ ] IaC (Amplify設定、CDK/Terraform)
- [ ] テストコード

### ドキュメント
- [ ] 運用マニュアル
- [ ] 保守マニュアル
- [ ] ユーザーマニュアル
- [ ] API仕様書
- [ ] トラブルシューティングガイド

### その他
- [ ] テスト結果報告書
- [ ] リリース手順書
- [ ] プロジェクト完了報告書

---

## 開発フェーズ詳細タスク

### フェーズ1: 基盤構築 (Week 1-3)
**Week 1**: 要件定義、システム設計  
**Week 2**: 認証基盤、API基盤構築  
**Week 3**: データベース、ストレージ構築

### フェーズ2: コア機能開発 (Week 4-10)
**Week 4-5**: フロントエンド共通部品、認証画面  
**Week 6-7**: 文書一覧、詳細、登録画面  
**Week 8-9**: バックエンドAPI (文書管理、承認)  
**Week 10**: 統合テスト

### フェーズ3: RAG・外部API (Week 11-14)
**Week 11-12**: OpenSearch構築、PDF処理、Bedrock連携  
**Week 13**: 検索・RAG機能実装  
**Week 14**: 外部API実装、統合テスト

### フェーズ4: リリース準備 (Week 15-20)
**Week 15-16**: システムテスト、パフォーマンステスト  
**Week 17-18**: 本番環境構築  
**Week 19**: 本番リリース  
**Week 20**: ドキュメント作成、運用準備

---

## 品質管理

### コード品質
- [ ] ESLint/Prettier設定
- [ ] 単体テストカバレッジ 80%以上
- [ ] コードレビュー実施
- [ ] セキュリティスキャン (npm audit, Snyk)

### テスト
- [ ] 単体テスト (Jest, Pytest)
- [ ] 統合テスト
- [ ] E2Eテスト (Cypress)
- [ ] パフォーマンステスト (Artillery, k6)
- [ ] セキュリティテスト (OWASP ZAP)

### 監視
- [ ] CloudWatch Logs
- [ ] CloudWatch Metrics
- [ ] X-Ray トレーシング
- [ ] エラー率監視
- [ ] レイテンシ監視

---

## コスト見積もり (月額)

| サービス | 想定利用量 | 月額コスト (USD) |
|---------|-----------|-----------------|
| Amplify Hosting | 1アプリ | $15 |
| CloudFront | 100GB転送 | $10 |
| Cognito | 1,000 MAU | $5 |
| API Gateway | 100万リクエスト | $3.5 |
| Lambda | 100万リクエスト | $20 |
| DynamoDB | 10GB、100万R/W | $15 |
| S3 | 100GB保存 | $2.5 |
| OpenSearch | t3.small.search x2 | $70 |
| Bedrock | 100万トークン | $30 |
| CloudWatch | ログ10GB | $5 |
| **合計** | | **$176** |

※ 実際のコストは利用量により変動します

---

## 次のアクション

1. **要件定義書の最終確認**
2. **AWSアカウント準備**
3. **開発環境構築開始**
4. **Week 1タスク着手**

